# ロボット-コンソール間通信プロトコル

ロボット-コンソール間は, byte配列でやり取りされる.

## プロトコル概観

送受信されるbyte配列の形式を次に示す.
各バイトの詳細は次章に記述する.

| 1バイト目 | 2バイト目 | 3バイト目以降 |
| --- | --- | --- |
| データの種別 | データの個数 | データのbyte表現 |

## 各バイトの詳細

### 1バイト目 : データの種別

送受信するデータの型を表す.

数値 | 表すデータ型
--- | ---
0x00 | 使用禁止
0x01 | boolean
0x02 | sbyte
0x03 | short
0x04 | int
0x05 | long
0x06 | byte
0x07 | ushort
0x08 | uint
0x09 | ulong
0x0A | decimal
0x0B | char
0x0C | float
0x0D | double
0x0E | string
0x0F～0xFF | 使用禁止

### 2バイト目 : データの個数

* 送受信データがstringの場合

  送受信する文字列の長さ.

  指定可能範囲は, 0x00～0xFFとする.

* 送受信データがstring以外の場合

  送受信したいデータの個数を表す.
    配列のような複数の値を一度に送受信することができるように, 本バイトを設ける.

  指定可能範囲は, 0x01～0xFFとする.

### 3バイト目 : データのbyte表現

送受信データをbyte表現したもの.

* データのbyte表現は, リトルエンディアンとする.

  EV3は値をリトルエンディアンで扱うため, リトルエンディアンで通信することで, EV3上でのエンディアン変換処理をしなくてすむ.

* stringを送受信する場合, 文字列はASCIIエンコーディングされる

  ASCII(0x00-0x7F)で表すことのできない文字(拡張ASCIIやマルチバイト文字)は送受信することができない.

* 配列を送受信する場合は, 各要素のデータのbyte表現が, 配列の要素数分だけ連続して並ぶ

* (留意事項)データのbyte表現は, データをbyte型にキャストしたものではなく, データをそのままbyte配列に変換したものである.

  両者の違いは, たとえば,

  * 0x01234567(int型)をbyte型にキャスト : 0x01234567 → 0x67

  * 0x01234567(int型)をbyte配列に変換 : 0x01234567 → { 0x67, 0x45, 0x23, 0x01 }

  となる. (このように, キャストでは, 丸めや切捨てが発生してしまう.)



